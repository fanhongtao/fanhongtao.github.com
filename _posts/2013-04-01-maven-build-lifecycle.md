---
layout: post
title: Maven生命周期
description:  Maven的三个生命周期：clean、default和site。
categories: maven
tags: [maven]
copyright: cn
---

# 1. 简介

Maven共有三个相互独立的生命周期（Build Lifecycle）：clean、default和site。

每个生命周期又可以细分成不同的阶段（Phase）。

# 2. clean生命周期
clean生命周期用于清理工程。

<table width="100%">
    <thead>
        <tr><th width="20%">阶段</th><th width="80%">功能</th></tr>
    </thead>
    <tbody>
        <tr><td> pre-clean </td><td> executes processes needed prior to the actual project cleaning <br> 执行在真正清理前需要完成的工作。缺省为空。 </td></tr>
        <tr><td> clean </td><td> remove all files generated by the previous build <br> 清理上一次构建时生成的文件。缺省为删除 target 目录。 </td></tr>
        <tr><td> post-clean </td><td> executes processes needed to finalize the project cleaning <br> 执行在清理后需要完成的工作。缺省为空。 </td></tr>
    </tbody>
</table>

# 3. default生命周期

default生命周期用于构建。

<table width="100%">
    <thead>
        <tr><th width="20%">阶段</th><th width="80%">功能</th></tr>
    </thead>
    <tbody>
        <tr><td> validate </td><td> validate the project is correct and all necessary information is available. </td></tr>
        <tr><td> initialize </td><td> initialize build state, e.g. set properties or create directories. </td></tr>
        <tr><td> generate-sources </td><td> generate any source code for inclusion in compilation. </td></tr>
        <tr><td> process-sources </td><td> process the source code, for example to filter any values. </td></tr>
        <tr><td> generate-resources </td><td> generate resources for inclusion in the package. </td></tr>
        <tr><td> process-resources </td><td> copy and process the resources into the destination directory, ready for packaging. </td></tr>
        <tr><td> compile </td><td> compile the source code of the project. <br> 编译项目中的源码</td></tr>
        <tr><td> process-classes </td><td> post-process the generated files from compilation, for example to do bytecode enhancement on Java classes. </td></tr>
        <tr><td> generate-test-sources </td><td> generate any test source code for inclusion in compilation. </td></tr>
        <tr><td> process-test-sources </td><td> process the test source code, for example to filter any values. </td></tr>
        <tr><td> generate-test-resources </td><td> create resources for testing. </td></tr>
        <tr><td> process-test-resources </td><td> copy and process the resources into the test destination directory. </td></tr>
        <tr><td> test-compile </td><td> compile the test source code into the test destination directory </td></tr>
        <tr><td> process-test-classes </td><td> post-process the generated files from test compilation, for example to do bytecode enhancement on Java classes. For Maven 2.0.5 and above. </td></tr>
        <tr><td> test </td><td> run tests using a suitable unit testing framework. These tests should not require the code be packaged or deployed. <br> 使用单元测试框架执行测试用例 </td></tr>
        <tr><td> prepare-package </td><td> perform any operations necessary to prepare a package before the actual packaging. This often results in an unpacked, processed version of the package. (Maven 2.1 and above) </td></tr>
        <tr><td> package </td><td> take the compiled code and package it in its distributable format, such as a JAR. <br> 将编译好的代码打包。如：打成 jar 包 </td></tr>
        <tr><td> pre-integration-test </td><td> perform actions required before integration tests are executed. This may involve things such as setting up the required environment. </td></tr>
        <tr><td> integration-test </td><td> process and deploy the package if necessary into an environment where integration tests can be run. </td></tr>
        <tr><td> post-integration-test </td><td> perform actions required after integration tests have been executed. This may including cleaning up the environment. </td></tr>
        <tr><td> verify </td><td> run any checks to verify the package is valid and meets quality criteria. </td></tr>
        <tr><td> install </td><td> install the package into the local repository, for use as a dependency in other projects locally. <br> 将包安装到本地仓库，以便本地的其它项目可以使用。 </td></tr>
        <tr><td> deploy </td><td> done in an integration or release environment, copies the final package to the remote repository for sharing with other developers and projects. <br> 将包部署到远端的仓库，以便其他开发人员可以使用。 </td></tr>
    </tbody>
</table>

# 4. site生命周期

site生命周期用于建立和发布项目站点。

<table width="100%">
    <thead>
        <tr><th width="20%">阶段</th><th width="80%">功能</th></tr>
    </thead>
    <tbody>
        <tr><td> pre-site </td><td> executes processes needed prior to the actual project site generation </td></tr>
        <tr><td> site </td><td> generates the project's site documentation </td></tr>
        <tr><td> post-site </td><td> executes processes needed to finalize the site generation, and to prepare for site deployment </td></tr>
        <tr><td> site-deploy </td><td> deploys the generated site documentation to the specified web server </td></tr>
    </tbody>
</table>

# 5. 执行顺序

执行 Maven 的主要方式就是调用 Maven 生命周期阶段。

注意：生命周期是相互独立的，但一个生命周期内部的阶段则是顺序的，要想执行后一个阶段，必须先执行前一个阶段。

* mvn clean : 调用 clean 生命周期的 clean 阶段。
* mvn test : 调用 default 生命周期的 test 阶段（及 test 阶段前的所有阶段）。
* mvn clean deploy : 先调用 clean 生命周期的 clean 阶段， 再调用 default 生命周期的 deploy 阶段。由于 deploy 是 default 生命周期中的最后一个阶段，所以执行了整个 default 生命周期。

通过执行下面的代码，可以更好的理解 phase 与 lifeCycle 之间的关系。
[MvnPhase.java](https://github.com/fanhongtao/BlogDemo/blob/master/Java/src/main/java/org/fanhongtao/maven/MvnPhase.java)


# 参考
* [Introduction to the Build Lifecycle](http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html)


